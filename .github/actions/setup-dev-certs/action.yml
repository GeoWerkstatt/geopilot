name: 'Setup Dev Certificates'
description: 'Creates and trusts development certificates'

inputs:
  export-path:
    description: 'Path to export the certificate to'
    required: true
    default: './certs/geopilot.pem'
  ubuntu-export-path:
    description: 'Path to export the certificate to on Ubuntu'
    required: true
    default: '/usr/local/share/ca-certificates/geopilot.crt'

runs:
  using: 'composite'
  steps:
      - name: Create dev-certs
        shell: bash
        run: |
          mkdir ./certs
          dotnet dev-certs https --export-path ${{ input.export-path }} --no-password --format PEM
          chmod -R 664 ./certs/*

      - name: Trust dev-certs
        shell: bash
        run: |
          sudo apt-get install -y ca-certificates
          sudo cp ${{ input.export-path }} ${{ input.ubuntu-export-path }}
          sudo update-ca-certificates
